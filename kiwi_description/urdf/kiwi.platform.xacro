<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="kiwi">

  <xacro:macro name="kiwi_platform" params="prefix='' mesh_dir='package://kiwi_description/meshes' ">

    <!-- Constants for robot dimensions -->
    <xacro:property name="PI" value="3.1415926535897931"/>
    <xacro:property name="base_mass" value="1.0" /> <!-- arbitrary value for base mass -->
    <xacro:property name="base_width" value="0.22" />
    <xacro:property name="base_length" value="0.21" />
    <xacro:property name="base_height" value="0.05" />
    <xacro:property name="wheel_mass" value="0.02" /> <!-- arbitrary value for wheel mass -->
    <xacro:property name="wheel_length" value="0.024" />
    <xacro:property name="wheel_radius" value="0.0185" />
    <xacro:property name="axel_to_base" value="0.00495" />

    <xacro:property name="half_width" value="${base_width / 2}" />
    <xacro:property name="half_length" value="${base_length / 2}" />

    <!-- Base Link -->
    <link name="${prefix}base_link">
      <collision>
        <origin xyz="0 0 ${wheel_radius + axel_to_base}" rpy="0 0 0"/>
        <geometry>
          <box size="${base_length} ${base_width} ${2 * wheel_radius + 0.01}"/>
        </geometry>
      </collision>

      <collision>
        <origin xyz="0 -0.03 0.06" rpy="0 0 0"/>
          <geometry>
            <box size="0.16 0.16 0.025"/>
          </geometry>
      </collision>

      <collision>
        <origin xyz="0 -0.03 0.1125" rpy="0 0 0"/>
          <geometry>
            <box size="0.12 0.16 0.08"/>
          </geometry>
      </collision>

      <visual>
        <origin xyz="${-half_length} ${-half_width} ${wheel_radius + 0.00495} " rpy="0 0 0"/>
        <geometry>
          <mesh filename="${mesh_dir}/base.dae"/>
        </geometry>
      </visual>
    </link>

    <!-- front left wheel link -->
    <joint name="${prefix}front_left_wheel_joint" type="continuous">
      <parent link="${prefix}base_link"/>
      <child link="${prefix}front_left_wheel"/>
      <origin xyz="${half_length - 0.03} ${half_width} ${wheel_radius}" rpy="-${PI/2} ${PI} 0"/>
      <axis xyz="0 0 1"/>
    </joint>

    <link name="${prefix}front_left_wheel">
      <collision>
        <origin xyz="0 0 ${wheel_length / 2}" rpy="0 0 0"/>
        <geometry>
          <cylinder radius="${wheel_radius}" length="${wheel_length}"/>
        </geometry>
      </collision>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="${mesh_dir}/mecanum_simple.dae"/>
        </geometry>
      </visual>
    </link>

    <!-- front right wheel link -->
    <joint name="${prefix}front_right_wheel_joint" type="continuous">
      <parent link="${prefix}base_link"/>
      <child link="${prefix}front_right_wheel"/>
      <origin xyz="${half_length - 0.03} ${-half_width} ${wheel_radius}" rpy="${PI/2} 0 0"/>
      <axis xyz="0 0 -1"/>
    </joint>

    <link name="${prefix}front_right_wheel">
      <collision>
        <origin xyz="0 0 ${wheel_length / 2}" rpy="0 0 0"/>
        <geometry>
          <cylinder radius="${wheel_radius}" length="${wheel_length}"/>
        </geometry>
      </collision>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="${mesh_dir}/mecanum_simple.dae"/>
        </geometry>

      </visual>
    </link>

    <!-- rear left wheel link -->
    <joint name="${prefix}rear_left_wheel_joint" type="continuous">
      <parent link="${prefix}base_link"/>
      <child link="${prefix}rear_left_wheel"/>
      <origin xyz="${-half_length + 0.03} ${half_width} ${wheel_radius}" rpy="-${PI/2} ${PI} 0"/>
      <axis xyz="0 0 1"/>
    </joint>

    <link name="${prefix}rear_left_wheel">
      <collision>
        <origin xyz="0 0 ${wheel_length / 2}" rpy="0 0 0"/>
        <geometry>
          <cylinder radius="${wheel_radius}" length="${wheel_length}"/>
        </geometry>
      </collision>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="${mesh_dir}/mecanum_simple.dae"/>
        </geometry>
      </visual>
    </link>

    <!-- rear right wheel link -->
    <joint name="${prefix}rear_right_wheel_joint" type="continuous">
      <parent link="${prefix}base_link"/>
      <child link="${prefix}rear_right_wheel"/>
      <origin xyz="${-half_length + 0.03} ${-half_width} ${wheel_radius}" rpy="${PI/2} 0 0"/>
      <axis xyz="0 0 -1"/>
    </joint>

    <link name="${prefix}rear_right_wheel">
      <collision>
        <origin xyz="0 0 ${wheel_length / 2}" rpy="0 0 0"/>
        <geometry>
          <cylinder radius="${wheel_radius}" length="${wheel_length}"/>
        </geometry>
      </collision>

      <visual>
        <origin xyz="0 0 0" rpy="0 0 0"/>
        <geometry>
          <mesh filename="${mesh_dir}/mecanum_simple.dae"/>
        </geometry>
      </visual>
    </link>

    <!-- lidar -->
    <joint name="${prefix}lidar_joint" type="fixed">
     <parent link="${prefix}base_link"/>
      <child link="${prefix}lidar"/>
      <origin xyz="${-half_length + 0.08} ${-half_width + 0.08} 0.1415" rpy="0 0 0"/>
      <axis xyz="0 0 1"/>
    </joint>

    <link name="${prefix}lidar"/>

  </xacro:macro>

</robot>